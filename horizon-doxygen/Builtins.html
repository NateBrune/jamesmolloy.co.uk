<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Horizon: Builtins</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Builtins </h1>  </div>
</div>
<div class="contents">
<p>Horizon's builtins or intrinsics are function calls that are inlined at compile time. Classes (but not interfaces or variants) can also be built-in, and have builtin member functions. The System.* classes are a good example of this.</p>
<p>Defining a builtin was an arduous process, as due to the decoupling of libraries in Horizon a builtin class had to be defined as a ClassTypeCtor in both Module and CompileManager, where member functions were assigned (with FunctionType s) attached.</p>
<p>This was before the builtin functions were even written! This was so torturous and error prone that a domain specific language (DSL) was introduced. The DSL is S-Expression based, so is Lisp-like (but contains none of the Lisp constructs - it is a declarative language, not an imperative one).</p>
<p>An example from the array.sexp definitions:</p>
<div class="fragment"><pre class="fragment">(<span class="keyword">class </span><a class="code" href="namespacehorizon_1_1TypeId.html#aa4890db2d34b6f15287b4cb4ad33a268">Array</a> Object
       (function () size () (do
                                (local llvm::Value* this_val)
                                (assign this_val (register this_reg))
                              (local llvm::Value* val)
                              (assign val (llvm:extractvalue (llvm:load (llvm:load this_val)) 0))
                              (return (llvm:store val (register (returns 0)))))))
</pre></div><p>This defines the class Array as a subclass of Object, having one function, <code>size</code>, taking no parameters and returning no values.</p>
<p>The function defines a local variable to which is assigned the llvm value of register <code>this_reg</code>, which is loaded (twice) and the 0'th value extracted, assigned to the <code>val</code> variable and stored back to the 0'th return register.</p>
<p>This DSL is used to write all of the .sexp files in the horizon/Builtins directory, and is compiled by the helper <a class="el" href="gen-builtins_8cc.html" title="Application to parse and compile builtin s-expressions to C++ code.">horizon/Builtins/gen-builtins.cc</a> .</p>
<ul>
<li><a class="el" href="BuiltinsCommands.html">Command Reference</a></li>
</ul>
<p>When adding a new .sexp file, you should edit <a class="el" href="Builtins_2Builtins_8cc.html">horizon/Builtins/Builtins.cc</a> and add calls to the macros:</p>
<ul>
<li><code><a class="el" href="Builtins_2Builtins_8cc.html#a341c69cb50bd0f6c2c7e359bbe11bb3a">EXTERN_BUILTIN(mybuiltinfilename)</a></code> </li>
<li><code><a class="el" href="Builtins_2Builtins_8cc.html#a594e3f83d394bbe3f12b18b771fd202f">CALL_BUILTIN_MGR(mybuiltinfilename)</a></code> </li>
<li><code><a class="el" href="Builtins_2Builtins_8cc.html#a34cd8af39668c3eae198977cf1071ac6">CALL_BUILTIN_MOD(mybuiltinfilename)</a></code> </li>
</ul>
<p>... obviously removing the .sexp from the filename first. </p>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Sep 29 2010 17:04:02 for Horizon by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
